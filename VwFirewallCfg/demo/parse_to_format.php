<?php

$g_str1='cscript.exe xcacls.vbs "%SystemRoot%/system32/arp.exe" /G Administrators:F
cscript.exe xcacls.vbs "%SystemRoot%/system32/arp.exe" /D Guests:F /E

cscript.exe xcacls.vbs "%SystemRoot%/system32/rsh.exe" /G Administrators:F
cscript.exe xcacls.vbs "%SystemRoot%/system32/rsh.exe" /D Guests:F /E

cscript.exe xcacls.vbs "%SystemRoot%/system32/netdde.exe" /G Administrators:F
cscript.exe xcacls.vbs "%SystemRoot%/system32/netdde.exe" /D Guests:F /E

cscript.exe xcacls.vbs "%SystemRoot%/system32/mshta.exe" /G Administrators:F
cscript.exe xcacls.vbs "%SystemRoot%/system32/mshta.exe" /D Guests:F /E

cscript.exe xcacls.vbs "%SystemRoot%/system32/mountvol.exe" /G Administrators:F
cscript.exe xcacls.vbs "%SystemRoot%/system32/mountvol.exe" /D Guests:F /E

cscript.exe xcacls.vbs "%SystemRoot%/system32/tftp.exe" /G Administrators:F
cscript.exe xcacls.vbs "%SystemRoot%/system32/tftp.exe" /D Guests:F /E

cscript.exe xcacls.vbs "%SystemRoot%/system32/setx.exe" /G Administrators:F
cscript.exe xcacls.vbs "%SystemRoot%/system32/setx.exe" /D Guests:F /E

cscript.exe xcacls.vbs "%SystemRoot%/system32/find.exe" /G Administrators:F
cscript.exe xcacls.vbs "%SystemRoot%/system32/find.exe" /D Guests:F /E

cscript.exe xcacls.vbs "%SystemRoot%/system32/finger.exe" /G Administrators:F
cscript.exe xcacls.vbs "%SystemRoot%/system32/finger.exe" /D Guests:F /E

cscript.exe xcacls.vbs "%SystemRoot%/system32/where.exe" /G Administrators:F
cscript.exe xcacls.vbs "%SystemRoot%/system32/where.exe" /D Guests:F /E

cscript.exe xcacls.vbs "%SystemRoot%/system32/regsvr32.exe" /G Administrators:F
cscript.exe xcacls.vbs "%SystemRoot%/system32/regsvr32.exe" /D Guests:F /E

cscript.exe xcacls.vbs "%SystemRoot%/system32/cacls.exe" /G Administrators:F
cscript.exe xcacls.vbs "%SystemRoot%/system32/cacls.exe" /D Guests:F /E

cscript.exe xcacls.vbs "%SystemRoot%/system32/sc.exe" /G Administrators:F
cscript.exe xcacls.vbs "%SystemRoot%/system32/sc.exe" /D Guests:F /E

cscript.exe xcacls.vbs "%SystemRoot%/system32/shadow.exe" /G Administrators:F
cscript.exe xcacls.vbs "%SystemRoot%/system32/shadow.exe" /D Guests:F /E

cscript.exe xcacls.vbs "%SystemRoot%/system32/runas.exe" /G Administrators:F
cscript.exe xcacls.vbs "%SystemRoot%/system32/runas.exe" /D Guests:F /E

cscript.exe xcacls.vbs "%SystemRoot%/system32/wshom.ocx" /G Administrators:F
cscript.exe xcacls.vbs "%SystemRoot%/system32/wshom.ocx" /D Guests:F /E

cscript.exe xcacls.vbs "%SystemRoot%/system32/wshext.dll" /G Administrators:F
cscript.exe xcacls.vbs "%SystemRoot%/system32/wshext.dll" /D Guests:F /E

cscript.exe xcacls.vbs "%SystemRoot%/system32/shell32.dll" /G Administrators:F
cscript.exe xcacls.vbs "%SystemRoot%/system32/shell32.dll" /D Guests:F /E

cscript.exe xcacls.vbs "%SystemRoot%/system32/zipfldr.dll" /G Administrators:F
cscript.exe xcacls.vbs "%SystemRoot%/system32/zipfldr.dll" /D Guests:F /E

cscript.exe xcacls.vbs "%SystemRoot%/PCHealth/HelpCtr/Binaries/msconfig.exe" /G Administrators:F
cscript.exe xcacls.vbs "%SystemRoot%/PCHealth/HelpCtr/Binaries/msconfig.exe" /D Guests:F /E

cscript.exe xcacls.vbs "%SystemRoot%/notepad.exe" /G Administrators:F
cscript.exe xcacls.vbs "%SystemRoot%/notepad.exe" /D Guests:F /E

cscript.exe xcacls.vbs "%SystemRoot%/regedit.exe" /G Administrators:F
cscript.exe xcacls.vbs "%SystemRoot%/regedit.exe" /D Guests:F /E

cscript.exe xcacls.vbs "%SystemRoot%/winhelp.exe" /G Administrators:F
cscript.exe xcacls.vbs "%SystemRoot%/winhelp.exe" /D Guests:F /E

cscript.exe xcacls.vbs "%SystemRoot%/winhlp32.exe" /G Administrators:F
cscript.exe xcacls.vbs "%SystemRoot%/winhlp32.exe" /D Guests:F /E

cscript.exe xcacls.vbs "%SystemRoot%/system32/notepad.exe" /G Administrators:F
cscript.exe xcacls.vbs "%SystemRoot%/system32/notepad.exe" /D Guests:F /E

cscript.exe xcacls.vbs "%SystemRoot%/system32/edlin.exe" /G Administrators:F
cscript.exe xcacls.vbs "%SystemRoot%/system32/edlin.exe" /D Guests:F /E

cscript.exe xcacls.vbs "%SystemRoot%/system32/posix.exe" /G Administrators:F
cscript.exe xcacls.vbs "%SystemRoot%/system32/posix.exe" /D Guests:F /E

cscript.exe xcacls.vbs "%SystemRoot%/system32/atsvc.exe" /G Administrators:F
cscript.exe xcacls.vbs "%SystemRoot%/system32/atsvc.exe" /D Guests:F /E

cscript.exe xcacls.vbs "%SystemRoot%/system32/qbasic.exe" /G Administrators:F
cscript.exe xcacls.vbs "%SystemRoot%/system32/qbasic.exe" /G Administrators:F

cscript.exe xcacls.vbs "%SystemRoot%/system32/runonce.exe" /G Administrators:F
cscript.exe xcacls.vbs "%SystemRoot%/system32/runonce.exe" /D Guests:F /E

cscript.exe xcacls.vbs "%SystemRoot%/system32/syskey.exe" /G Administrators:F
cscript.exe xcacls.vbs "%SystemRoot%/system32/syskey.exe" /D Guests:F /E

cscript.exe xcacls.vbs "%SystemRoot%/system32/cscript.exe" /G Administrators:F
cscript.exe xcacls.vbs "%SystemRoot%/system32/cscript.exe" /D Guests:F /E';


//	.........................
$g_str2 = 'cscript.exe xcacls.vbs "%SystemRoot%/ServicePackFiles/i386/activeds.dll" /R "Power Users" /E
cscript.exe xcacls.vbs "%SystemRoot%/ServicePackFiles/i386/activeds.dll" /R "Users" /E

cscript.exe xcacls.vbs "%SystemRoot%/system32/activeds.dll" /R "Power Users" /E
cscript.exe xcacls.vbs "%SystemRoot%/system32/activeds.dll" /R "Users" /E

cscript.exe xcacls.vbs "%SystemRoot%/system32/activeds.tlb" /R "Power Users" /E
cscript.exe xcacls.vbs "%SystemRoot%/system32/activeds.tlb" /R "Users" /E;';

parse_str2();

function parse_str2()
{
	global $g_str2;

	$ArrNew = Array();
	$ArrStr1 = explode( "\n\n", $g_str2 );
	foreach ( $ArrStr1 as $item )
	{
		$Arr = explode( "\n", $item );
		$path = substr( $Arr[0], strlen("cscript.exe xcacls.vbs \"") );
		$pos  = strpos( $path, "\"" );
		if ( false !== $pos )
		{
			$sResult = substr( $path, 0, $pos );
			//echo $sResult . "\r\n";
			$ArrFile = explode( "/", $sResult );
			$ArrNew[] = Array( 'path' => $sResult, 'file' => $ArrFile[ count($ArrFile)-1 ] );
		}
	}
	foreach ( $ArrNew as $item )
	{
	$sNewLine = ';
;
;
[' . $item['file'] . ']
name="免疫“木马列出IIS目录”(' . $item['file'] . ')"
[' . $item['file'] . '.set]
type=acls|||user=Power Users|||chk=A|||cmd=%SystemRoot%\system32\cscript.exe %vwloc%\xcacls.vbs|||path=' . $item['path'] . '|||param=/R "Power Users" /E|||
type=acls|||user=Users|||chk=A|||cmd=%SystemRoot%\system32\cscript.exe %vwloc%\xcacls.vbs|||path=' . $item['path'] . '|||param=/R "Users" /E|||';
	echo $sNewLine;
	echo "\r\n\r\n";
	}
	
	echo "\r\n\r\n\r\n";
	
	foreach ( $ArrNew as $item )
	{
		echo "rule=" . $item['file'];
		echo "\r\n";
	}	
}




function parse_str1()
{
	global $g_str1;

	$ArrNew = Array();
	$ArrStr1 = explode( "\n\n", $g_str1 );
	foreach ( $ArrStr1 as $item )
	{
		$Arr = explode( "\n", $item );
		$path = substr( $Arr[0], strlen("cscript.exe xcacls.vbs \"") );
		$pos  = strpos( $path, "\"" );
		if ( false !== $pos )
		{
			$sResult = substr( $path, 0, $pos );
			//echo $sResult . "\r\n";
			$ArrFile = explode( "/", $sResult );
			$ArrNew[] = Array( 'path' => $sResult, 'file' => $ArrFile[ count($ArrFile)-1 ] );
		}
	}
	foreach ( $ArrNew as $item )
	{
		$sNewLine = ';
	;
	;
	[' . $item['file'] . ']
	name="' . $item['file'] . '安全"
	[' . $item['file'] . '.set]
	type=acls|||user=Guests|||chk=D|||cmd=%SystemRoot%\system32\cscript.exe %vwloc%\xcacls.vbs|||path=' . $item['path'] . '|||param=/G Administrators:F|||
	type=acls|||user=Guests|||chk=D|||cmd=%SystemRoot%\system32\cscript.exe %vwloc%\xcacls.vbs|||path=' . $item['path'] . '|||param=/D Guests:F /E|||';
		echo $sNewLine;
		echo "\r\n\r\n";
	}
	
	echo "\r\n\r\n\r\n";
	
	foreach ( $ArrNew as $item )
	{
		echo "rule=" . $item['file'];
		echo "\r\n";
	}	
}

?>